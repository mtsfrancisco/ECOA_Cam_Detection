<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuários</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <header class="header">Face Recognition Admin</header>
    
    <div class="user-container">
        <h2>Lista de Usuários</h2>
        <div class="user-grid">
            {% for user in users %}
                <div class="user-card">
                    {% if user.image_64 %}
                        <img src="{{ user.image_64 }}" alt="Foto de {{ user.name }}">
                    {% else %}
                        <img src="{% static 'images/default_avatar.png' %}" alt="Imagem padrão">
                    {% endif %}
                    <h3>{{ user.name }} {{ user.last_name }}</h3>
                    <p>Gênero: {{ user.gender }}</p>
                    <p>ID: {{ user.user_id }}</p>
                    <a href="#" class="btn" onclick="openEditPopup('{{ user.user_id }}')">Modificar</a>
                </div>
            {% empty %}
                <p>Nenhum usuário encontrado.</p>
            {% endfor %}
        </div>
    </div>

    
<!-- Pop-up de edição -->
<div id="edit-popup" class="popup">
    <div class="popup-content">
        <span class="close-btn" onclick="closeEditPopup()">&times;</span>
        <h2>Editar Usuário</h2>
        <form id="edit-user-form">
            <input type="hidden" id="edit-user-id">
            <label for="edit-name">Nome:</label>
            <input type="text" id="edit-name">
            
            <label for="edit-last-name">Sobrenome:</label>
            <input type="text" id="edit-last-name">
            
            <label for="edit-gender">Gênero:</label>
            <select id="edit-gender">
                <option value="M">Masculino</option>
                <option value="F">Feminino</option>
                <option value="O">Outro</option>
            </select>
            
            <label for="edit-image">Nova Imagem:</label>
            <input type="file" id="edit-image">
            
            <button type="button" onclick="submitEditUser()">Salvar</button>
        </form>
    </div>
</div>

<!-- Script para manipular o pop-up e enviar os dados via AJAX -->
<script>
function openEditPopup(userId) {
    document.getElementById("edit-user-id").value = userId;
    document.getElementById("edit-popup").style.display = "block";
}

function closeEditPopup() {
    document.getElementById("edit-popup").style.display = "none";
}

async function submitEditUser() {
    const userId = document.getElementById("edit-user-id").value;
    const name = document.getElementById("edit-name").value;
    const lastName = document.getElementById("edit-last-name").value;
    const gender = document.getElementById("edit-gender").value;
    const imageInput = document.getElementById("edit-image");

    let formData = new FormData();
    formData.append("name", name);
    formData.append("last_name", lastName);
    formData.append("gender", gender);
    if (imageInput.files.length > 0) {
        formData.append("image", imageInput.files[0]);
    }

    const response = await fetch(`/update_user/${userId}/`, {
        method: "POST",
        body: formData,
    });

    const result = await response.json();
    if (response.ok) {
        alert("Usuário atualizado com sucesso!");
        location.reload();
    } else {
        alert("Erro: " + result.error);
    }
}
</script>

</body>
</html>

